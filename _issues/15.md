---
title: "Powershell"
date: 2023-02-22 13:46:41 -0600
modified: 2023-04-13 13:28:41 -0600
id: 15
---


## List the pending/missing Windows updates.

```ps1
$UpdateSession = New-Object -ComObject Microsoft.Update.Session
$UpdateSearcher = $UpdateSession.CreateupdateSearcher()
$Updates = @($UpdateSearcher.Search("IsHidden=0 and IsInstalled=0").Updates)
$Updates | ConvertTo-Json -Depth 1
```

[Source](https://gist.github.com/Grimthorr/44727ea8cf5d3df11cf7)


## Copy NTFS permissions

```ps1
get-acl C:\path_with_desired_permissions | set-acl C:\path_lacking_desired_permissions

# set recursively
$perm = Get-Acl C:\path_with_desired_permissions
Get-ChildItem C:\path_lacking_desired_permissions -Recurse | Set-Acl -AclObject $perm -WhatIf
```


## Set-Acl 
https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-acl?view=powershell-7.3


### Example 1: Copy a security descriptor from one file to another

```powershell
$DogACL = Get-Acl -Path "C:\Dog.txt"
Set-Acl -Path "C:\Cat.txt" -AclObject $DogACL
```

### Example 2: Use the pipeline operator to pass a descriptor

```powershell
Get-Acl -Path "C:\Dog.txt" | Set-Acl -Path "C:\Cat.txt"
```

### Example 3: Apply a security descriptor to multiple files

```powershell
$NewAcl = Get-Acl File0.txt
Get-ChildItem -Path "C:\temp" -Recurse -Include "*.txt" -Force | Set-Acl -AclObject $NewAcl
```


## Get stopped services with Automatic startup

```powershell
Get-WmiObject -Class Win32_Service | Select-Object Name,State,StartMode | Where-Object {$_.State -ne 
"Running" -and $_.StartMode -eq "Auto"}
```

[Source](https://superuser.com/a/1136147)

